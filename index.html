<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Faiora - Digital Planner Prototype</title>
    <link rel="icon" href="logo.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- Identity & Branding -->
    <meta name="description" content="Ignite your productivity with Faiora Digital Planner. Sync tasks and goals with Google.">
    <meta property="og:title" content="Faiora Digital Planner">
    <meta property="og:description" content="A fiery approach to digital planning.">
    <meta property="og:image" content="https://johnpaulinso.github.io/Faiora/logo.png">
    <meta property="og:url" content="https://johnpaulinso.github.io/Faiora/">
    
    <!-- Google Site Verification (Placeholder) -->
    <!-- Replace 'YOUR_VERIFICATION_CODE' with the code from Google Search Console -->
    <meta name="google-site-verification" content="googled6ec6ba0775bed83" />
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/history@5/umd/history.development.js"></script>
    <script src="https://unpkg.com/react-router@6.3.0/umd/react-router.development.js"></script>
    <script src="https://unpkg.com/react-router-dom@6.3.0/umd/react-router-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <!-- Firebase SDK (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,opsz,wght@0,6..72,200..800;1,6..72,200..800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#f97316",
                        "primary-dark": "#ea580c",
                        "burnt-orange": "#7c2d12",
                        "charcoal": "#0a0a0a",
                        "cream-light": "#fff7ed",
                        "pastel-orange": "#ffedd5",
                        "pastel-peach": "#fed7aa",
                        "pastel-amber": "#fef3c7",
                        "pastel-yellow": "#fef9c3",
                        "gold-glow": "#fbbf24",
                    },
                    fontFamily: {
                        "display": ["Newsreader", "serif"],
                        "sans": ["Inter", "system-ui", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "2xl": "1.5rem", "3xl": "2rem", "full": "9999px" },
                },
            },
        }
    </script>

    <style type="text/tailwindcss">
        html {
            font-size: 14.4px; /* 90% of default 16px */
            user-select: none;
            -webkit-user-select: none;
        }
        .dark-gradient-bg {
            background: linear-gradient(180deg, #7c2d12 0%, #111827 40%, #0a0a0a 100%);
            background-attachment: fixed;
        }
        .card-glow {
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5), 0 0 20px rgba(253, 186, 116, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card-glow:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.6), 0 0 30px rgba(249, 115, 22, 0.2);
            z-index: 10;
        }
        .glow-orange {
            filter: drop-shadow(0 0 8px rgba(249, 115, 22, 0.6));
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        /* Specific override for Task Creator to ensure solid background as requested */
        .task-creator-modal {
            background-color: #fcfaf7 !important; /* Match modal example.html */
            backdrop-filter: none !important;
            border: none !important;
        }
        .modal-top-progress {
            height: 6px;
            width: 100%;
            background: #f1f5f9; /* slate-100 */
            overflow: hidden;
        }
        .modal-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f97316 0%, #fbbf24 100%);
            transition: width 0.5s ease;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .fab-shadow {
            box-shadow: 0 15px 35px -5px rgba(249, 115, 22, 0.4);
        }
        .sticky-note-1 { transform: rotate(-1.5deg); }
        .sticky-note-2 { transform: rotate(1.2deg); }
        .sticky-note-3 { transform: rotate(-0.8deg); }
        .sticky-note-4 { transform: rotate(2deg); }
        .sticky-note-5 { transform: rotate(-1.2deg); }
        .sticky-note-add { transform: rotate(0.5deg); }
        
        /* Loading Screen Specifics */
        .blur-overlay {
            backdrop-filter: blur(80px) saturate(120%);
            background: rgba(10, 10, 10, 0.7);
        }
        .flame-container {
            position: absolute;
            top: -18px; /* -20px * 0.9 */
            left: 0;
            right: 0;
            height: 36px; /* 40px * 0.9 */
            display: flex;
            justify-content: space-around;
            pointer-events: none;
        }
        .flame-tongue {
            width: 10.8px; /* 12px * 0.9 */
            height: 27px; /* 30px * 0.9 */
            background: linear-gradient(to top, rgba(249, 115, 22, 0.8), rgba(239, 68, 68, 0.4), transparent);
            border-radius: 50% 50% 20% 20%;
            filter: blur(5.4px); /* 6px * 0.9 */
            animation: flame-rise 2.5s infinite ease-in-out;
            transform-origin: bottom center;
        }
        @keyframes flame-rise {
            0%, 100% { transform: scaleY(1) translateY(0) scaleX(1); opacity: 0.4; }
            50% { transform: scaleY(1.5) translateY(-13.5px) scaleX(0.8); opacity: 0.7; }
        }
        .loading-arc {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            border: 1.8px solid transparent; /* 2px * 0.9 */
            border-top: 1.8px solid #f97316;
            filter: drop-shadow(0 0 13.5px rgba(249, 115, 22, 0.8));
            animation: spin-smooth 3s linear infinite;
        }
        @keyframes spin-smooth {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Clock */
        /* Selection & Inputs */
        input, textarea, [contenteditable="true"], .block-input {
            -webkit-user-select: text !important;
            -ms-user-select: text !important;
            user-select: text !important;
        }
        
        .analog-clock {
            width: 270px; /* 300px * 0.9 */
            height: 270px; /* 300px * 0.9 */
            border-radius: 50%;
            border: 2px solid rgba(249, 115, 22, 0.3);
            position: relative;
            background: rgba(0, 0, 0, 0.2);
            box-shadow: 0 0 40px rgba(249, 115, 22, 0.1), inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        /* Page Transition Animations */
        .fire-wipe-overlay {
            position: fixed;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            pointer-events: none;
            display: flex;
            align-items: flex-end;
            will-change: transform;
        }

        .fire-wipe-active {
            animation: fire-wipe-sweep 1.8s cubic-bezier(0.4, 0, 0.2, 1) forwards !important;
        }

        .fire-bg-video {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            opacity: 0.25;
            mix-blend-mode: screen; /* Note: Can be expensive, but looks best */
            pointer-events: none;
            backface-visibility: hidden;
            transform: translateZ(0);
        }

        /* Floating Pill Toolbar - Repositioned to bottom center */
        .floating-toolbar-pill {
            display: flex;
            align-items: center;
            background: white;
            padding: 8px 16px;
            border-radius: 9999px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.12);
            gap: 12px;
            z-index: 60;
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s cubic-bezier(0.19, 1, 0.22, 1);
            position: absolute;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
        }
        .toolbar-inner-divider {
            width: 1px;
            height: 20px;
            background: rgba(0,0,0,0.1);
            margin: 0 4px;
        }
        .toolbar-icon-btn {
            color: rgba(0,0,0,0.4);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .toolbar-icon-btn:hover {
            color: rgba(0,0,0,0.8);
            transform: translateY(-1px);
        }
        .toolbar-icon-btn.active, .toolbar-icon-btn.highlighter {
            color: #f97316 !important;
            opacity: 1 !important;
        }

        /* Footer Refinement */
        .task-creator-footer {
            padding: 0.75rem 1rem;
            background: #fdfcfb !important;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-top: 1px solid #f1f5f9; /* border-slate-100 */
            min-height: 64px;
        }
        .footer-divider {
            width: 1px;
            height: 24px;
            background: #e2e8f0; /* slate-200 */
            margin: 0 4px;
        }
        .close-btn {
            padding: 0.625rem 1.5rem;
            color: #1e293b; /* slate-800 */
            border-radius: 0.5rem;
            font-family: inherit;
            font-weight: 500;
            font-size: 0.875rem;
            transition: background 0.2s;
        }
        .close-btn:hover {
            background: #f1f5f9; /* slate-100 */
        }
        .save-pill-btn {
            padding: 0.625rem 2rem;
            background: #f97316;
            color: white;
            border-radius: 9999px;
            font-family: inherit;
            font-weight: 700;
            font-size: 0.875rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            box-shadow: 0 10px 20px rgba(249, 115, 22, 0.2);
            transition: all 0.2s;
        }
        .save-pill-btn:hover {
            background: #ea580c;
            transform: translateY(-1px);
            box-shadow: 0 12px 24px rgba(249, 115, 22, 0.3);
        }
        .block-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid #f97316;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 6px;
        }
        .block-checkbox.checked {
            background: #f97316;
        }
        .block-checkbox.checked::after {
            content: 'check';
            font-family: 'Material Symbols Outlined';
            font-size: 14px;
            color: white;
            font-weight: bold;
        }

        .block-bullet {
            width: 6px;
            height: 6px;
            background: rgba(0,0,0,0.4);
            border-radius: 50%;
            margin-top: 14px;
        }

        .footer-action-btn {
            padding: 10px;
            border-radius: 8px;
            color: rgba(0,0,0,0.6);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .footer-action-btn:hover {
            background: rgba(0,0,0,0.04);
            color: rgba(0,0,0,0.9);
        }
        /* Save Button */
        .save-pill-btn {
            background: #f97316;
            color: white;
            padding: 8px 24px;
            border-radius: 9999px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.2);
            transition: all 0.3s;
            font-size: 13px;
            font-family: 'Inter', sans-serif;
        }
        .save-pill-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(249, 115, 22, 0.3);
            filter: brightness(1.05);
        }

        .fire-wipe-sprite {
            width: 100vw;
            height: 360px; /* 400px * 0.9 */
            background-image: url('fire-wipe-spritesheet.png');
            background-repeat: no-repeat;
            background-size: 100% 1800px; /* 2000px * 0.9 */
            animation: fire-wipe-sprites 0.5s steps(5) infinite;
            filter: drop-shadow(0 0 40px rgba(249, 115, 22, 0.9));
            opacity: 0.98;
            backface-visibility: hidden;
            transform: translateZ(0);
        }

        @keyframes fire-wipe-sweep {
            0% { transform: translate3d(0, 70vh, 0); opacity: 0; }
            15% { opacity: 1; }
            85% { opacity: 1; }
            100% { transform: translate3d(0, -100vh, 0); opacity: 0; }
        }

        @keyframes fire-wipe-sprites {
            to { background-position: 0 -1800px; } /* 2000px * 0.9 */
        }

        .dissolve-layer {
            transition: opacity 0.3s ease-in-out, filter 0.3s ease-in-out;
        }

        .dissolve-out {
            opacity: 0;
            filter: blur(2px);
        }

        .dissolve-in {
            opacity: 1;
            filter: blur(0);
            animation: content-fade-in 0.4s ease-out forwards;
        }

        @keyframes content-fade-in {
            from { 
                opacity: 0;
                transform: translate3d(0, 10px, 0);
            }
            to { 
                opacity: 1;
                transform: translate3d(0, 0, 0);
            }
        }

        /* Liquid Progress Bar */
        .liquid-progress {
            position: relative;
            background: rgba(0, 0, 0, 0.4);
            overflow: visible; /* Allow handle to glow outside */
            border-radius: 0; /* Keep it flush for now or subtle round */
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
            height: 32px !important; /* Larger hit area */
            border-bottom: 1px solid rgba(249, 115, 22, 0.2);
        }
        .liquid-fill {
            height: 100%;
            background: linear-gradient(90deg, #7c2d12, #f97316, #fed7aa);
            background-size: 200% 100%;
            position: relative;
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            animation: move-gradient 3s linear infinite;
        }
        .liquid-glow-handle {
            position: absolute;
            right: -12px;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 20px #f97316, 0 0 40px #f97316;
            z-index: 10;
            pointer-events: none;
            border: 2px solid #ea580c;
        }
        
        /* Floating Selection Menu */
        .selection-menu {
            position: fixed;
            z-index: 500;
            display: flex;
            gap: 4px;
            padding: 6px;
            background: #1a1a1a;
            border: 1px solid rgba(249, 115, 22, 0.3);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5), 0 0 20px rgba(249, 115, 22, 0.1);
            transform: translate(-50%, -100%);
            margin-top: -12px;
            animation: pop-up 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes pop-up {
            from { opacity: 0; transform: translate(-50%, -80%) scale(0.9); }
            to { opacity: 1; transform: translate(-50%, -100%) scale(1); }
        }
        
        .selection-menu-btn {
            padding: 6px;
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .selection-menu-btn:hover {
            background: rgba(249, 115, 22, 0.15);
            color: #f97316;
        }
        @keyframes move-gradient {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }
        
        .block-input:focus {
            outline: none;
        }
        .block-input::placeholder {
            color: rgba(255, 247, 237, 0.1);
        }

        /* Note Themes (Solid Colors) */
        .theme-amber { background-color: #fef3c7 !important; color: #451a03 !important; backdrop-filter: none !important; }
        .theme-orange { background-color: #fff7ed !important; color: #431407 !important; backdrop-filter: none !important; }
        .theme-peach { background-color: #fff7ed !important; color: #431407 !important; backdrop-filter: none !important; }
        .theme-yellow { background-color: #ffffdd !important; color: #422006 !important; backdrop-filter: none !important; }
        .theme-green { background-color: #e8f5e9 !important; color: #1b5e20 !important; }
        .theme-blue { background-color: #e3f2fd !important; color: #0d47a1 !important; }
        .theme-purple { background-color: #f3e5f5 !important; color: #4a148c !important; }
        .theme-pink { background-color: #fce4ec !important; color: #880e4f !important; }
        
        .glass-panel[class*='theme-'] {
            background: unset !important;
            backdrop-filter: none !important;
            border: none !important;
            box-shadow: 0 40px 100px rgba(0,0,0,0.3) !important;
        }

        .theme-amber .block-input, .theme-orange .block-input, .theme-peach .block-input, 
        .theme-yellow .block-input, .theme-green .block-input, .theme-blue .block-input,
        .theme-purple .block-input, .theme-pink .block-input {
            color: inherit !important;
            font-family: 'Inter', sans-serif !important;
            user-select: text !important;
        }
        
        .theme-amber input::placeholder, .theme-orange input::placeholder, .theme-peach input::placeholder,
        .theme-yellow input::placeholder, .theme-green input::placeholder, .theme-blue input::placeholder,
        .theme-purple input::placeholder, .theme-pink input::placeholder {
            color: rgba(0,0,0,0.1) !important;
        }
        .theme-amber .block-input::placeholder, .theme-orange .block-input::placeholder, .theme-peach .block-input::placeholder,
        .theme-yellow .block-input::placeholder, .theme-green .block-input::placeholder, .theme-blue .block-input::placeholder,
        .theme-purple .block-input::placeholder, .theme-pink .block-input::placeholder {
            color: rgba(0, 0, 0, 0.2) !important;
        }
    </style>
<style>
    body {
      min-height: max(795px, 100dvh); /* 884px * 0.9 */
    }
  </style>
  </head>
<body class="dark-gradient-bg font-display text-slate-100 min-h-screen selection:bg-primary/30 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;
        const { createRoot } = ReactDOM;
        const { MemoryRouter, Routes, Route, Link, useNavigate, useLocation } = ReactRouterDOM;

        // --- Firebase Initialization ---
        const firebaseConfig = {
            apiKey: "AIzaSyDktbyVgI7AAwaY2u-KsWBRwLZawy0949s",
            authDomain: "faiora-24f4a.firebaseapp.com",
            projectId: "faiora-24f4a",
            storageBucket: "faiora-24f4a.firebasestorage.app",
            messagingSenderId: "752265363994",
            appId: "1:752265363994:web:78795bfad67d2d541e07a3",
            measurementId: "G-B0DWSL1JMV"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const googleProvider = new firebase.auth.GoogleAuthProvider();

        // --- Shared Components ---

        const Sidebar = () => {
            const location = useLocation();
            const isActive = (path) => location.pathname === path;

            return (
                <aside className="hidden md:flex w-24 border-r border-white/5 flex-col items-center py-10 gap-10 bg-black/40 backdrop-blur-xl z-20">
                    <div className="text-primary mb-6">
                        <span className="material-symbols-outlined text-4xl font-light glow-orange" style={{fontVariationSettings: '"FILL" 1'}}>local_fire_department</span>
                    </div>
                    <nav className="flex flex-col gap-8">
                        <Link to="/" className={`group relative p-3 rounded-2xl transition-all duration-300 ${isActive('/') ? 'bg-primary/10 text-primary' : 'text-slate-500 hover:text-primary'}`} title="Tasks">
                            <span className="material-symbols-outlined text-3xl">check_box</span>
                        </Link>
                        <Link to="/notes" className={`group relative p-3 rounded-2xl transition-all duration-300 ${isActive('/notes') ? 'bg-primary/10 text-primary' : 'text-slate-500 hover:text-primary'}`} title="Notes">
                            <span className="material-symbols-outlined text-3xl">grid_view</span>
                        </Link>
                        <Link to="/calendar" className={`group relative p-3 rounded-2xl transition-all duration-300 ${isActive('/calendar') ? 'bg-primary/10 text-primary' : 'text-slate-500 hover:text-primary'}`} title="Calendar">
                            <span className="material-symbols-outlined text-3xl">calendar_month</span>
                        </Link>
                        <Link to="/stats" className={`group relative p-3 rounded-2xl transition-all duration-300 ${isActive('/stats') ? 'bg-primary/10 text-primary' : 'text-slate-500 hover:text-primary'}`} title="Graph">
                            <span className="material-symbols-outlined text-3xl">leaderboard</span>
                        </Link>
                        <Link to="/streak" className={`group relative p-3 rounded-2xl transition-all duration-300 ${isActive('/streak') ? 'bg-primary/10 text-primary glow-orange' : 'text-slate-500 hover:text-primary'}`} title="Flame">
                            <span className="material-symbols-outlined text-3xl" style={isActive('/streak') ? {fontVariationSettings: '"FILL" 1'} : {}}>local_fire_department</span>
                        </Link>
                        <Link to="/clock" className={`group relative p-3 rounded-2xl transition-all duration-300 ${isActive('/clock') ? 'bg-primary/10 text-primary' : 'text-slate-500 hover:text-primary'}`} title="Clock">
                            <span className="material-symbols-outlined text-3xl">history</span>
                        </Link>
                    </nav>
                </aside>
            );
        };

        const MobileNav = () => {
            const location = useLocation();
            const isActive = (path) => location.pathname === path;
            
            return (
                <nav className="fixed bottom-0 left-0 right-0 bg-black/80 backdrop-blur-2xl border-t border-white/5 flex justify-around items-center py-5 md:hidden z-50">
                    <Link to="/" className={isActive('/') ? 'text-primary' : 'text-slate-500'}>
                        <span className="material-symbols-outlined text-3xl">check_box</span>
                    </Link>
                    <Link to="/notes" className={isActive('/notes') ? 'text-primary' : 'text-slate-500'}>
                        <span className="material-symbols-outlined text-3xl">grid_view</span>
                    </Link>
                    <Link to="/streak" className={isActive('/streak') ? 'text-primary glow-orange' : 'text-slate-500'}>
                        <span className="material-symbols-outlined text-3xl" style={{fontVariationSettings: isActive('/streak') ? '"FILL" 1' : ''}}>local_fire_department</span>
                    </Link>
                    <Link to="/stats" className={isActive('/stats') ? 'text-primary' : 'text-slate-500'}>
                        <span className="material-symbols-outlined text-3xl">leaderboard</span>
                    </Link>
                    <Link to="/clock" className={isActive('/clock') ? 'text-primary' : 'text-slate-500'}>
                        <span className="material-symbols-outlined text-3xl">history</span>
                    </Link>
                </nav>
            );
        };

        const Layout = ({ children, onOpenCreator }) => {
            return (
                <div className="flex h-screen overflow-hidden">
                    <Sidebar />
                    <main className="flex-1 flex flex-col overflow-y-auto no-scrollbar relative">
                        {children}
                        <button 
                            onClick={onOpenCreator}
                            className="fixed bottom-12 right-12 w-20 h-20 bg-primary hover:bg-primary-dark text-white rounded-full flex items-center justify-center fab-shadow transition-all duration-300 hover:scale-110 active:scale-95 z-40 group"
                        >
                            <span className="material-symbols-outlined text-4xl group-hover:rotate-90 transition-transform duration-300">add</span>
                        </button>
                    </main>
                    <MobileNav />
                </div>
            );
        };

        const UserMenu = ({ user }) => {
            const [isOpen, setIsOpen] = useState(false);
            const menuRef = useRef();

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (menuRef.current && !menuRef.current.contains(event.target)) {
                        setIsOpen(false);
                    }
                };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);

            const handleLogout = () => {
                auth.signOut();
                localStorage.removeItem('faiora_logged_in');
            };

            return (
                <div className="relative" ref={menuRef}>
                    <button 
                        onClick={() => setIsOpen(!isOpen)}
                        className="w-12 h-12 rounded-full overflow-hidden border border-white/10 ring-4 ring-black/20 hover:ring-primary/40 transition-all duration-300"
                    >
                        <img 
                            alt={user.displayName} 
                            className="w-full h-full object-cover bg-primary/20" 
                            src={user.photoURL || "https://www.gravatar.com/avatar/00000000000000000000000000000000?d=mp&f=y"}
                        />
                    </button>

                    {isOpen && (
                        <div className="absolute right-0 mt-4 w-64 glass-panel rounded-3xl p-2 shadow-2xl z-[100] animate-in fade-in slide-in-from-top-4 duration-300 overflow-hidden">
                            <div className="p-4 border-b border-white/5 mb-2">
                                <p className="text-cream-light font-bold truncate">{user.displayName}</p>
                                <p className="text-cream-light/40 text-xs truncate">{user.email}</p>
                            </div>
                            <button className="flex items-center gap-3 w-full p-3 hover:bg-white/5 rounded-2xl text-cream-light/60 hover:text-primary transition-all text-sm group">
                                <span className="material-symbols-outlined text-xl group-hover:scale-110 transition-transform">person</span>
                                Profile
                            </button>
                            <button className="flex items-center gap-3 w-full p-3 hover:bg-white/5 rounded-2xl text-cream-light/60 hover:text-primary transition-all text-sm group">
                                <span className="material-symbols-outlined text-xl group-hover:scale-110 transition-transform">settings</span>
                                Settings
                            </button>
                            <div className="h-px bg-white/5 my-2"></div>
                            <button 
                                onClick={handleLogout}
                                className="flex items-center gap-3 w-full p-3 hover:bg-red-500/10 rounded-2xl text-red-400 hover:text-red-300 transition-all text-sm group"
                            >
                                <span className="material-symbols-outlined text-xl group-hover:scale-110 transition-transform">logout</span>
                                Logout
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        const Header = ({ title = "Faiora", subtitle = "Digital Planner", user }) => (
            <header className="flex justify-between items-start mb-16 px-4 md:px-0">
                <div className="flex items-center gap-4">
                    <div>
                        <h1 className="text-7xl font-bold tracking-tight text-cream-light italic leading-none">{title}</h1>
                        <p className="text-primary/70 text-sm mt-3 uppercase tracking-[0.4em] font-sans font-semibold">{subtitle}</p>
                    </div>
                </div>
                <div className="flex items-center gap-6">
                    <button className="text-cream-light/40 hover:text-cream-light transition-colors">
                        <span className="material-symbols-outlined text-2xl">search</span>
                    </button>
                    <UserMenu user={user} />
                </div>
            </header>
        );

        const TaskCreator = ({ onClose, user }) => {
            const [title, setTitle] = useState("");
            const [blocks, setBlocks] = useState([{ id: 1, type: 'text', content: '' }]);
            const [progress, setProgress] = useState(0);
            const [history, setHistory] = useState([]);
            const [historyIndex, setHistoryIndex] = useState(-1);
            const [isPinned, setIsPinned] = useState(false);
            const [selection, setSelection] = useState(null);
            const [noteTheme, setNoteTheme] = useState('peach');
            const [showPalette, setShowPalette] = useState(false);
            const [activeBlockId, setActiveBlockId] = useState(null);

            useEffect(() => {
                if (!user) return;
                db.collection('tasks').doc(user.uid).get().then(function(doc) {
                    if (doc.exists) {
                        var data = doc.data();
                        if (data.title) setTitle(data.title);
                        if (data.blocks) setBlocks(data.blocks);
                        if (data.progress !== undefined) setProgress(data.progress);
                        if (data.isPinned !== undefined) setIsPinned(data.isPinned);
                        if (data.noteTheme) setNoteTheme(data.noteTheme);
                    }
                })["catch"](function(e) {
                    console.error("Error loading tasks", e);
                });
            }, [user]);

            const themes = [
                { id: 'glass', color: 'rgba(255,255,255,0.05)', themeClass: '' },
                { id: 'amber', color: '#fef3c7', themeClass: 'theme-amber' },
                { id: 'orange', color: '#ffedd5', themeClass: 'theme-orange' },
                { id: 'peach', color: '#ffedd5', themeClass: 'theme-peach' },
                { id: 'yellow', color: '#fef9c3', themeClass: 'theme-yellow' },
                { id: 'green', color: '#ecfdf5', themeClass: 'theme-green' },
                { id: 'blue', color: '#e0f2fe', themeClass: 'theme-blue' },
                { id: 'purple', color: '#f5f3ff', themeClass: 'theme-purple' },
                { id: 'pink', color: '#fdf2f8', themeClass: 'theme-pink' },
            ];

            const saveToFirestore = useCallback(function(data) {
                if (!user) return;
                var dataToSave = {};
                for (var key in data) { dataToSave[key] = data[key]; }
                dataToSave.updatedAt = firebase.firestore.FieldValue.serverTimestamp();

                db.collection("tasks").doc(user.uid).set(dataToSave, { merge: true })["catch"](function(e) {
                    console.error("Error saving to Firestore", e);
                });
            }, [user]);

            const saveState = useCallback(() => {
                const currentState = { title, blocks: JSON.parse(JSON.stringify(blocks)), progress, isPinned, noteTheme };
                const newHistory = history.slice(0, historyIndex + 1);
                newHistory.push(currentState);
                setHistory(newHistory.slice(-30));
                setHistoryIndex(Math.min(newHistory.length - 1, 29));
                
                // Auto-save to Firestore
                saveToFirestore(currentState);
            }, [title, blocks, progress, isPinned, history, historyIndex, noteTheme, saveToFirestore]);

            const undo = () => {
                if (historyIndex > 0) {
                    const prev = history[historyIndex - 1];
                    setTitle(prev.title);
                    setBlocks(prev.blocks);
                    setProgress(prev.progress);
                    setIsPinned(prev.isPinned);
                    setNoteTheme(prev.noteTheme || 'glass');
                    setHistoryIndex(historyIndex - 1);
                }
            };

            const redo = () => {
                if (historyIndex < history.length - 1) {
                    const next = history[historyIndex + 1];
                    setTitle(next.title);
                    setBlocks(next.blocks);
                    setProgress(next.progress);
                    setIsPinned(next.isPinned);
                    setNoteTheme(next.noteTheme || 'glass');
                    setHistoryIndex(historyIndex + 1);
                }
            };

            const handleProgressClick = (e) => {
                const rect = e.currentTarget.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const percent = Math.round((x / rect.width) * 10) * 10;
                setProgress(Math.max(0, Math.min(100, percent)));
                saveState();
            };

            const addBlock = (type, currentId = null) => {
                const newBlock = { id: Date.now(), type, content: '', checked: false };
                if (currentId) {
                    const index = blocks.findIndex(b => b.id === currentId);
                    const newBlocks = [...blocks];
                    newBlocks.splice(index + 1, 0, newBlock);
                    setBlocks(newBlocks);
                } else {
                    setBlocks([...blocks, newBlock]);
                }
                saveState();
            };

            const updateBlock = (id, updates) => {
                setBlocks(blocks.map(b => b.id === id ? { ...b, ...updates } : b));
            };

            const removeBlock = (id) => {
                if (blocks.length > 1) {
                    setBlocks(blocks.filter(b => b.id !== id));
                    saveState();
                }
            };

            const handleTextSelection = (e, blockId) => {
                const sel = window.getSelection();
                if (sel.toString().length > 0) {
                    const range = sel.getRangeAt(0);
                    const rect = range.getBoundingClientRect();
                    setSelection({
                        blockId,
                        top: rect.top,
                        left: rect.left + rect.width / 2,
                        text: sel.toString()
                    });
                } else {
                    setSelection(null);
                }
            };

            const convertActiveBlock = function(type) {
                var id = activeBlockId || (blocks.length > 0 ? blocks[0].id : null);
                if (id) {
                    updateBlock(id, { type: type });
                    saveState();
                }
            };

            const handleKeyDown = (e, block) => {
                // We no longer add a new block on Enter to allow standard line breaks
            };

            // Calculate numbers for blocks
            const blocksWithNumbers = useMemo(() => {
                let currentNum = 0;
                return blocks.map((b, i) => {
                    if (b.type === 'number') {
                        // Check previous block type
                        const prev = blocks[i - 1];
                        if (prev && prev.type === 'number') {
                            currentNum++;
                        } else {
                            currentNum = 1;
                        }
                        return { ...b, number: currentNum };
                    }
                    currentNum = 0;
                    return b;
                });
            }, [blocks]);

            var theme = themes.find(function(t) { return t.id === noteTheme; });
            var currentThemeClass = theme ? theme.themeClass : '';

            return (
                <div className="fixed inset-0 z-[110] flex items-center justify-center p-4 md:p-8 animate-in fade-in duration-500" onMouseUp={handleTextSelection}>
                    <div className="absolute inset-0 bg-black/70 backdrop-blur-2xl" onClick={function() { saveState(); onClose(); }}></div>
                    
                    <div className={`task-creator-modal w-full max-w-2xl rounded-3xl overflow-hidden flex flex-col relative z-10 shadow-2xl animate-in zoom-in-95 duration-500 transition-colors duration-500 ${currentThemeClass}`}>
                        
                        {/* Top Progress Bar */}
                        <div className="modal-top-progress">
                            <div className="modal-progress-fill" style={{ width: progress + "%" }}></div>
                        </div>

                        <div className="flex-1 overflow-y-auto p-8 md:p-10 no-scrollbar relative flex flex-col">
                            <div className="flex justify-between items-start mb-6">
                                <input 
                                    type="text" 
                                    placeholder="MAIN TITLE" 
                                    className="bg-transparent border-none text-3xl md:text-4xl font-bold text-slate-800 placeholder:text-slate-300 focus:ring-0 w-full tracking-tight font-display uppercase"
                                    value={title}
                                    onChange={(e) => setTitle(e.target.value)}
                                    onBlur={saveState}
                                />
                                <button 
                                    onClick={() => { setIsPinned(!isPinned); saveState(); }}
                                    className={"p-2 rounded-full transition-all " + (isPinned ? "text-primary bg-primary/10" : "text-slate-400 hover:text-slate-600")}
                                >
                                    <span className="material-symbols-outlined text-[28px]" style={isPinned ? {fontVariationSettings: "'FILL' 1"} : {}}>push_pin</span>
                                </button>
                            </div>

                            <div className="space-y-6 flex-1">
                                {blocksWithNumbers.map((block, index) => (
                                    <div key={block.id} className="flex items-start gap-4 group">
                                        <div className="flex-1 flex items-start gap-3">
                                            <span className="material-symbols-outlined drag-indicator mt-2">drag_indicator</span>
                                            {block.type === 'todo' && (
                                                <div 
                                                    onClick={() => { updateBlock(block.id, { checked: !block.checked }); saveState(); }}
                                                    className={"mt-2 block-checkbox shrink-0 " + (block.checked ? "checked" : "")}
                                                ></div>
                                            )}
                                            {block.type === 'bullet' && (
                                                <div className="mt-4 block-bullet shrink-0"></div>
                                            )}
                                            {block.type === 'number' && (
                                                <div className="mt-1.5 block-number shrink-0">
                                                    {block.number}.
                                                </div>
                                            )}
                                            <textarea 
                                                className={"bg-transparent border-none flex-1 p-0 text-xl transition-all focus:ring-0 block-input resize-none h-auto min-h-[1.5em] leading-[1.6] " + (block.checked ? "opacity-30 line-through text-slate-400" : "text-slate-600")}
                                                style={{ fontFamily: "'Inter', sans-serif" }}
                                                value={block.content}
                                                placeholder={index === 0 ? "Take a note..." : ""}
                                                rows={1}
                                                onFocus={() => setActiveBlockId(block.id)}
                                                onKeyDown={(e) => handleKeyDown(e, block)}
                                                onChange={(e) => {
                                                    e.target.style.height = 'auto';
                                                    e.target.style.height = e.target.scrollHeight + 'px';
                                                    updateBlock(block.id, { content: e.target.value });
                                                }}
                                                onBlur={saveState}
                                            />
                                        </div>
                                        <button onClick={() => removeBlock(block.id)} className="opacity-0 group-hover:opacity-100 p-2 text-slate-300 hover:text-red-500 transition-all shrink-0">
                                            <span className="material-symbols-outlined text-lg">delete</span>
                                        </button>
                                    </div>
                                ))}
                                <div className="pb-24"></div>
                            </div>

                            {/* Floating Pill Toolbar - Repositioned inside content at bottom */}
                            {activeBlockId && (
                                <div className="floating-toolbar-pill" style={{
                                    display: (selection || activeBlockId) ? 'flex' : 'none'
                                }}>
                                    <button onClick={() => convertActiveBlock('todo')} className="toolbar-icon-btn" title="Checklist">
                                        <span className="material-symbols-outlined text-2xl">checklist</span>
                                    </button>
                                    <button onClick={() => convertActiveBlock('bullet')} className="toolbar-icon-btn" title="Bullets">
                                        <span className="material-symbols-outlined text-2xl">format_list_bulleted</span>
                                    </button>
                                    <button onClick={() => convertActiveBlock('number')} className="toolbar-icon-btn" title="Numbers">
                                        <span className="material-symbols-outlined text-2xl">format_list_numbered</span>
                                    </button>
                                    <button className="toolbar-icon-btn highlighter active" title="Highlighter">
                                        <span className="material-symbols-outlined text-2xl">edit_note</span>
                                    </button>
                                    <div className="toolbar-inner-divider"></div>
                                    <button onClick={undo} disabled={historyIndex <= 0} className="toolbar-icon-btn disabled:opacity-20" title="Undo">
                                        <span className="material-symbols-outlined text-2xl">undo</span>
                                    </button>
                                    <button onClick={undo} disabled={historyIndex <= 0} className="toolbar-icon-btn disabled:opacity-20" title="Undo">
                                        <span className="material-symbols-outlined text-2xl">undo</span>
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* Bottom Actions Toolbar */}
                        <div className="task-creator-footer mt-auto">
                            <div className="flex items-center gap-0.5 md:gap-1">
                                <button className="footer-action-btn" title="Add Alert">
                                    <span className="material-symbols-outlined text-[22px]">notifications</span>
                                </button>
                                <button className="footer-action-btn" title="Collaborator">
                                    <span className="material-symbols-outlined text-[22px]">person_add</span>
                                </button>
                                <div className="relative">
                                    <button onClick={() => setShowPalette(!showPalette)} className={"footer-action-btn " + (showPalette ? "bg-black/5 text-black" : "")} title="Theme">
                                        <span className="material-symbols-outlined text-[22px]">palette</span>
                                    </button>
                                    {showPalette && (
                                        <div className="absolute bottom-full mb-4 left-0 flex gap-1.5 p-2 bg-white rounded-2xl shadow-2xl border border-black/5 z-50">
                                            {themes.map(t => (
                                                <button 
                                                    key={t.id}
                                                    onClick={() => { setNoteTheme(t.id); setShowPalette(false); saveState(); }}
                                                    className={"w-8 h-8 rounded-full border-2 transition-all hover:scale-110 " + (noteTheme === t.id ? "border-primary" : "border-transparent")}
                                                    style={{ backgroundColor: t.id === 'glass' ? 'rgba(0,0,0,0.05)' : t.color }}
                                                />
                                            ))}
                                        </div>
                                    )}
                                </div>
                                <button className="footer-action-btn" title="Add Image">
                                    <span className="material-symbols-outlined text-[22px]">image</span>
                                </button>
                                <button className="footer-action-btn" title="Archive">
                                    <span className="material-symbols-outlined text-[22px]">archive</span>
                                </button>
                                <button className="footer-action-btn" title="More">
                                    <span className="material-symbols-outlined text-[22px]">more_vert</span>
                                </button>
                                <div className="footer-divider"></div>
                                <button onClick={undo} disabled={historyIndex <= 0} className="footer-action-btn disabled:opacity-20" title="Undo">
                                    <span className="material-symbols-outlined text-[22px]">undo</span>
                                </button>
                                <button onClick={redo} disabled={historyIndex >= history.length - 1} className="footer-action-btn disabled:opacity-20" title="Redo">
                                    <span className="material-symbols-outlined text-[22px]">redo</span>
                                </button>
                            </div>

                            <div className="flex items-center gap-3">
                                <button 
                                    onClick={onClose}
                                    className="close-btn"
                                >
                                    Close
                                </button>
                                <button 
                                    onClick={function() { saveState(); onClose(); }}
                                    className="save-pill-btn"
                                >
                                    SAVE
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        const LoginModal = () => {
            const handleLogin = () => {
                auth.signInWithPopup(googleProvider)
                    .then(() => localStorage.setItem('faiora_logged_in', 'true'))
                    .catch(e => console.error("Login failed", e));
            };

            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-6 blur-overlay overflow-hidden">
                    <div className="absolute inset-0 z-0">
                        <div className="absolute top-1/4 left-1/4 w-96 h-96 bg-primary/20 rounded-full blur-[120px] animate-pulse"></div>
                        <div className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-burnt-orange/30 rounded-full blur-[120px] animate-pulse delay-1000"></div>
                    </div>
                    
                    <div className="glass-panel max-w-xl w-full p-12 rounded-[3.5rem] flex flex-col items-center text-center relative z-10 shadow-2xl border-white/10">
                        <div className="mb-10 relative">
                             <div className="flame-container flex justify-center !static h-16 mb-4">
                                {[...Array(3)].map((_, i) => (
                                    <div key={i} className="flame-tongue !w-16 !h-24 mx-2" style={{animationDelay: `${i * 0.2}s`}}></div>
                                ))}
                            </div>
                            <h2 className="text-8xl font-black text-cream-light italic tracking-tighter drop-shadow-[0_0_50px_rgba(249,115,22,0.4)]">Faiora</h2>
                            <p className="text-primary font-bold uppercase tracking-[0.8em] text-sm mt-4">Ignite your productivity</p>
                        </div>

                        <p className="text-cream-light/60 text-lg mb-12 max-w-md font-sans leading-relaxed">
                            Experience a fiery approach to digital planning. Sync your lists, tasks, and goals with Google and light up your potential.
                        </p>

                        <button 
                            onClick={handleLogin}
                            className="bg-white text-black py-5 px-10 rounded-3xl font-bold flex items-center gap-4 hover:bg-primary hover:text-white transition-all duration-500 hover:scale-105 active:scale-95 shadow-xl group mb-12"
                        >
                            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" className="w-6 h-6 group-hover:invert transition-all" alt="Google" />
                            <span className="text-xl">Login with Google</span>
                        </button>

                        <div className="flex gap-8 text-[10px] uppercase tracking-widest font-bold text-cream-light/20">
                            <a href="https://johnpaulinso.github.io/Faiora/privacy.html" className="hover:text-primary transition-colors">Privacy Policy</a>
                            <a href="https://johnpaulinso.github.io/Faiora/terms.html" className="hover:text-primary transition-colors">Terms of Service</a>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Page Components ---

        const DashboardPage = ({ user, onOpenCreator }) => (
            <Layout onOpenCreator={onOpenCreator}>
                <div className="max-w-7xl mx-auto w-full px-8 md:px-16 py-12">
                    <Header user={user} />
                    <section className="mb-12">
                        <div className="flex items-center gap-4">
                            <h2 className="text-2xl font-bold text-cream-light/90 uppercase tracking-[0.3em]">TO DO LIST</h2>
                            <div className="h-[1px] flex-1 bg-gradient-to-r from-primary/30 to-transparent"></div>
                        </div>
                    </section>
                    <section className="grid grid-cols-2 lg:grid-cols-6 gap-6 mb-20 px-2">
                        {/* Sticky Notes */}
                        <div className="card-glow sticky-note-1 aspect-square bg-orange-100/90 rounded-2xl p-6 flex flex-col justify-between border-b-4 border-orange-300/50 group cursor-pointer relative overflow-hidden">
                            <span className="material-symbols-outlined text-orange-600/60 text-xl">push_pin</span>
                            <div className="flex flex-col gap-0.5">
                                <p className="text-[0.6rem] font-sans font-bold text-orange-900/30 uppercase tracking-[0.2em]">Priority</p>
                                <p className="text-xl font-bold text-orange-950/80 tracking-tight">3A</p>
                            </div>
                        </div>
                        <div className="card-glow sticky-note-2 aspect-square bg-amber-50/90 rounded-2xl p-6 flex flex-col justify-between border-b-4 border-amber-200/50 group cursor-pointer">
                            <span className="material-symbols-outlined text-amber-600/60 text-xl">shopping_bag</span>
                            <div className="flex flex-col gap-0.5">
                                <p className="text-[0.6rem] font-sans font-bold text-amber-900/30 uppercase tracking-[0.2em]">Label</p>
                                <p className="text-xl font-bold text-amber-950/80 tracking-tight">Errands</p>
                            </div>
                        </div>
                        <div className="card-glow sticky-note-3 aspect-square bg-orange-50/90 rounded-2xl p-6 flex flex-col justify-between border-b-4 border-orange-200/50 group cursor-pointer">
                            <span className="material-symbols-outlined text-orange-500/60 text-xl">cleaning_services</span>
                            <div className="flex flex-col gap-0.5">
                                <p className="text-[0.6rem] font-sans font-bold text-orange-900/30 uppercase tracking-[0.2em]">Label</p>
                                <p className="text-xl font-bold text-orange-950/80 tracking-tight">Chores</p>
                            </div>
                        </div>
                        <div className="card-glow sticky-note-4 aspect-square bg-pastel-peach/90 rounded-2xl p-6 flex flex-col justify-between border-b-4 border-orange-300/50 group cursor-pointer">
                            <span className="material-symbols-outlined text-orange-700/60 text-xl">shopping_cart</span>
                            <div className="flex flex-col gap-0.5">
                                <p className="text-[0.6rem] font-sans font-bold text-orange-900/30 uppercase tracking-[0.2em]">Label</p>
                                <p className="text-xl font-bold text-orange-950/80 tracking-tight">Groceries</p>
                            </div>
                        </div>
                        <div className="card-glow sticky-note-5 aspect-square bg-yellow-50/90 rounded-2xl p-6 flex flex-col justify-between border-b-4 border-yellow-200/50 group cursor-pointer">
                            <span className="material-symbols-outlined text-yellow-700/60 text-xl">more_horiz</span>
                            <div className="flex flex-col gap-0.5">
                                <p className="text-[0.6rem] font-sans font-bold text-yellow-900/30 uppercase tracking-[0.2em]">Label</p>
                                <p className="text-xl font-bold text-yellow-950/80 tracking-tight">Others</p>
                            </div>
                        </div>
                        <div 
                            onClick={onOpenCreator}
                            className="sticky-note-add aspect-square border-2 border-dashed border-primary/40 rounded-2xl p-6 flex flex-col items-center justify-center group cursor-pointer hover:bg-primary/5 transition-colors"
                        >
                            <div className="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary mb-3">
                                <span className="material-symbols-outlined text-2xl">add</span>
                            </div>
                            <p className="text-sm font-bold text-primary/80 uppercase tracking-widest text-center px-2">Add New Reminder</p>
                        </div>
                    </section>
                    <section className="grid grid-cols-1 lg:grid-cols-3 gap-12 mb-32">
                        <div className="lg:col-span-2 space-y-6">
                            <div className="glass-panel rounded-3xl p-8 flex items-center justify-between group hover:bg-white/5 transition-colors cursor-pointer">
                                <div className="flex items-center gap-6">
                                    <div className="w-12 h-12 rounded-full border border-primary/40 flex items-center justify-center text-primary">
                                        <span className="material-symbols-outlined">circle</span>
                                    </div>
                                    <div>
                                        <h4 className="text-xl text-cream-light font-medium">Finalize project proposal</h4>
                                        <p className="text-cream-light/40 text-sm font-sans mt-1">Due Today  Priority 3A</p>
                                    </div>
                                </div>
                                <span className="material-symbols-outlined text-cream-light/20 group-hover:text-primary transition-colors">chevron_right</span>
                            </div>
                            <div className="glass-panel rounded-3xl p-8 flex items-center justify-between group hover:bg-white/5 transition-colors cursor-pointer">
                                <div className="flex items-center gap-6">
                                    <div className="w-12 h-12 rounded-full border border-white/10 flex items-center justify-center text-cream-light/20">
                                        <span className="material-symbols-outlined">circle</span>
                                    </div>
                                    <div>
                                        <h4 className="text-xl text-cream-light font-medium">Weekly meal prep</h4>
                                        <p className="text-cream-light/40 text-sm font-sans mt-1">Due Tomorrow  Chores</p>
                                    </div>
                                </div>
                                <span className="material-symbols-outlined text-cream-light/20 group-hover:text-primary transition-colors">chevron_right</span>
                            </div>
                        </div>
                        <div className="glass-panel rounded-3xl p-10 flex flex-col items-center justify-center text-center space-y-6">
                            <div className="w-20 h-20 bg-primary/10 rounded-full flex items-center justify-center text-primary mb-2">
                                <span className="material-symbols-outlined text-4xl" style={{fontVariationSettings: '"FILL" 1'}}>bolt</span>
                            </div>
                            <h3 className="text-2xl font-bold text-cream-light">Quick Focus</h3>
                            <p className="text-cream-light/60 font-sans leading-relaxed">Start a 25-minute pomodoro session to breeze through your tasks.</p>
                            <button className="w-full bg-primary/20 hover:bg-primary/30 text-primary border border-primary/30 py-4 rounded-2xl font-bold transition-all uppercase tracking-widest text-xs">Start Session</button>
                        </div>
                    </section>
                </div>
            </Layout>
        );

        const NotesPage = ({ user, onOpenCreator }) => (
            <Layout onOpenCreator={onOpenCreator}>
                <div className="max-w-7xl mx-auto w-full px-6 md:px-16 py-12">
                    <Header user={user} />
                    <section className="mb-10">
                        <div className="flex items-center gap-4">
                            <h2 className="text-xl md:text-2xl font-bold text-cream-light/90 uppercase tracking-[0.3em]">ALL NOTES</h2>
                            <div className="h-[1px] flex-1 bg-gradient-to-r from-primary/30 to-transparent"></div>
                        </div>
                    </section>
                    <section className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 pb-32">
                        <div className="card-glow sticky-note-1 bg-amber-50/95 rounded-3xl p-7 min-h-[220px] flex flex-col border-b-8 border-amber-200/50 group cursor-pointer relative">
                            <div className="absolute top-4 right-4 text-amber-600">
                                <span className="material-symbols-outlined text-xl" style={{fontVariationSettings: "'FILL' 1"}}>push_pin</span>
                            </div>
                            <h3 className="text-xl font-bold text-amber-950 mb-3 pr-6">Q3 Strategy Goals</h3>
                            <div className="flex-1">
                                <p className="text-amber-900/70 font-sans text-sm leading-relaxed line-clamp-4">Focus on user retention metrics. Implement new onboarding flow by end of August.</p>
                            </div>
                            <div className="mt-4 flex gap-2">
                                <span className="text-[10px] font-bold uppercase tracking-widest bg-amber-200/40 text-amber-800 px-2 py-1 rounded">Strategy</span>
                            </div>
                        </div>
                        <div className="card-glow sticky-note-2 bg-orange-50/95 rounded-3xl p-7 min-h-[220px] flex flex-col border-b-8 border-orange-200/50 group cursor-pointer relative">
                            <h3 className="text-xl font-bold text-orange-950 mb-3">Grocery List</h3>
                            <div className="flex-1 space-y-2">
                                <div className="flex items-center gap-2 text-orange-900/80 font-sans text-sm">
                                    <span className="material-symbols-outlined text-lg">check_box_outline_blank</span>
                                    <span>Fresh basil & tomatoes</span>
                                </div>
                                <div className="flex items-center gap-2 text-orange-900/80 font-sans text-sm">
                                    <span className="material-symbols-outlined text-lg">check_box_outline_blank</span>
                                    <span>Organic honey</span>
                                </div>
                            </div>
                            <div className="mt-4 flex gap-2">
                                <span className="text-[10px] font-bold uppercase tracking-widest bg-orange-200/40 text-orange-800 px-2 py-1 rounded">Personal</span>
                            </div>
                        </div>
                        <div className="card-glow sticky-note-3 bg-pastel-peach/95 rounded-3xl p-7 min-h-[220px] flex flex-col border-b-8 border-orange-300/50 group cursor-pointer relative">
                            <h3 className="text-xl font-bold text-orange-950 mb-3">Gift Ideas</h3>
                            <div className="flex-1">
                                <p className="text-orange-900/70 font-sans text-sm leading-relaxed line-clamp-4 italic">"The best gifts are experiences that light a fire..."</p>
                            </div>
                        </div>
                    </section>
                </div>
            </Layout>
        );

        const CalendarPage = ({ user, onOpenCreator }) => (
            <Layout onOpenCreator={onOpenCreator}>
                <div className="flex-1 flex flex-col md:flex-row h-full">
                    <div className="flex-1 overflow-y-auto no-scrollbar px-6 md:px-12 py-10">
                        <Header user={user} />
                        <div className="flex items-center justify-between mb-8">
                            <div className="flex items-center gap-6">
                                <h2 className="text-3xl font-display font-bold text-cream-light italic">March 2026</h2>
                                <div className="flex gap-2">
                                    <button className="p-2 glass-panel rounded-full text-cream-light/60 hover:text-primary transition-colors"><span className="material-symbols-outlined">chevron_left</span></button>
                                    <button className="p-2 glass-panel rounded-full text-cream-light/60 hover:text-primary transition-colors"><span className="material-symbols-outlined">chevron_right</span></button>
                                </div>
                            </div>
                            <div className="flex bg-black/30 p-1 rounded-xl glass-panel">
                                <button className="px-4 py-2 text-xs font-bold uppercase tracking-widest text-cream-light/40 hover:text-cream-light">Week</button>
                                <button className="px-4 py-2 text-xs font-bold uppercase tracking-widest bg-primary/20 text-primary rounded-lg">Month</button>
                            </div>
                        </div>
                        <div className="glass-panel rounded-3xl overflow-hidden border-white/5 shadow-2xl">
                            <div className="grid grid-cols-7 bg-white/5 text-center border-b border-white/5 py-4">
                                {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                                    <div key={day} className="text-[10px] font-bold text-primary/60 uppercase tracking-widest">{day}</div>
                                ))}
                            </div>
                            <div className="grid grid-cols-7 auto-rows-[minmax(120px,_1fr)]">
                                {[...Array(31)].map((_, i) => (
                                    <div key={i} className={`border-r border-b border-white/5 p-4 hover:bg-white/5 transition-colors group cursor-pointer ${i === 9 ? 'bg-primary/10' : ''}`}>
                                        <span className={`text-sm font-sans ${i === 9 ? 'font-bold text-primary' : ''}`}>{i + 1}</span>
                                        {i === 9 && <div className="absolute top-3 right-3 w-1.5 h-1.5 rounded-full bg-primary glow-orange"></div>}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                    <aside className="w-full md:w-96 border-l border-white/5 bg-black/20 backdrop-blur-md p-8 overflow-y-auto no-scrollbar">
                        <div className="mb-10">
                            <div className="flex items-center gap-4 mb-2">
                                <h3 className="text-2xl font-display font-bold text-cream-light italic">Daily Agenda</h3>
                                <div className="h-px flex-1 bg-gradient-to-r from-primary/30 to-transparent"></div>
                            </div>
                            <p className="text-cream-light/40 text-xs font-sans uppercase tracking-[0.2em] font-bold">Tuesday, Mar 10</p>
                        </div>
                        <div className="space-y-6">
                            <div className="card-glow bg-orange-100/90 rounded-2xl p-5 border-b-4 border-orange-300/50 cursor-pointer">
                                <h4 className="text-lg font-bold text-orange-950/80 leading-tight">Project sync with team</h4>
                                <p className="text-xs text-orange-900/60 mt-2 font-sans">9:00 AM  Priority 3A</p>
                            </div>
                        </div>
                    </aside>
                </div>
            </Layout>
        );

        const StatsPage = ({ user, onOpenCreator }) => (
            <Layout onOpenCreator={onOpenCreator}>
                <div className="max-w-7xl mx-auto w-full px-6 md:px-12 py-10 pb-32">
                    <Header user={user} subtitle="Productivity Statistics" />
                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <div className="lg:col-span-4 glass-panel rounded-3xl p-8 flex flex-col items-center justify-center card-glow">
                            <h3 className="text-xl font-display font-bold text-cream-light italic mb-8 w-full">Overall Progress</h3>
                            <div className="relative w-56 h-56 flex items-center justify-center">
                                <svg className="w-full h-full -rotate-90" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" fill="transparent" r="42" stroke="rgba(255,255,255,0.05)" strokeWidth="8"></circle>
                                    <circle cx="50" cy="50" fill="transparent" r="42" stroke="#f97316" strokeDasharray="211 264" strokeLinecap="round" strokeWidth="8"></circle>
                                </svg>
                                <div className="absolute inset-0 flex flex-col items-center justify-center">
                                    <span className="text-4xl font-display font-bold text-cream-light">80%</span>
                                    <span className="text-[10px] font-bold text-primary/60 uppercase tracking-widest mt-1">Completed</span>
                                </div>
                            </div>
                        </div>
                        <div className="lg:col-span-8 glass-panel rounded-3xl p-8 card-glow">
                            <h3 className="text-xl font-display font-bold text-cream-light italic mb-8">Completion per List</h3>
                            <div className="space-y-8">
                                <div className="space-y-2">
                                    <div className="flex justify-between text-xs font-sans font-medium text-cream-light/60"><span>Priority 3A</span><span>92%</span></div>
                                    <div className="w-full h-2 bg-white/5 rounded-full overflow-hidden">
                                        <div className="h-full bg-pastel-orange rounded-full" style={{width: '92%'}}></div>
                                    </div>
                                </div>
                                <div className="space-y-2">
                                    <div className="flex justify-between text-xs font-sans font-medium text-cream-light/60"><span>Errands</span><span>75%</span></div>
                                    <div className="w-full h-2 bg-white/5 rounded-full overflow-hidden">
                                        <div className="h-full bg-pastel-peach rounded-full" style={{width: '75%'}}></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </Layout>
        );

        const StreakPage = ({ user, onOpenCreator }) => (
            <Layout onOpenCreator={onOpenCreator}>
                <div className="max-w-7xl mx-auto w-full px-8 md:px-16 py-12">
                    <Header user={user} subtitle="Streak & Achievements" />
                    <section className="mb-16 flex flex-col items-center text-center">
                        <div className="relative mb-6">
                            <span className="material-symbols-outlined text-[120px] text-primary glow-orange leading-none relative z-10" style={{fontVariationSettings: "'FILL' 1"}}>local_fire_department</span>
                        </div>
                        <h2 className="text-8xl font-black text-primary italic glow-orange tracking-tighter mb-2">12 DAYS</h2>
                        <p className="text-cream-light/40 text-lg uppercase tracking-[0.5em] font-sans font-bold">Current Streak</p>
                    </section>
                    <section className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-20">
                        <div className="glass-panel card-glow rounded-3xl p-8 flex flex-col items-center text-center gap-4">
                            <div className="w-16 h-16 rounded-full bg-amber-400/10 flex items-center justify-center text-amber-400 border border-amber-400/30">
                                <span className="material-symbols-outlined text-3xl" style={{fontVariationSettings: "'FILL' 1"}}>light_mode</span>
                            </div>
                            <h3 className="text-xl font-bold text-cream-light">Early Bird</h3>
                            <p className="text-cream-light/40 text-sm font-sans">Completed 5 tasks before 8AM</p>
                        </div>
                        {/* More badges can go here */}
                    </section>
                </div>
            </Layout>
        );

        const ClockPage = ({ user, onOpenCreator }) => (
            <Layout onOpenCreator={onOpenCreator}>
                <div className="max-w-7xl mx-auto w-full px-8 md:px-16 py-12">
                    <Header user={user} subtitle="Clock & Notifications" />
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center min-h-[500px]">
                        <div className="flex flex-col items-center justify-center space-y-12">
                            <div className="analog-clock flex items-center justify-center">
                                <div className="absolute w-[2px] h-[108px] bg-white origin-bottom rotate-[190deg] rounded-full bottom-[50%]"></div>
                                <div className="absolute w-[4px] h-[72px] bg-white origin-bottom rotate-[45deg] rounded-full bottom-[50%]"></div>
                                <div className="absolute w-[1px] h-[117px] bg-primary origin-bottom rotate-[310deg] rounded-full bottom-[50%] glow-orange"></div>
                                <div className="w-3 h-3 bg-primary border-2 border-white rounded-full z-10"></div>
                            </div>
                            <div className="text-center">
                                <h2 className="text-6xl font-display text-cream-light mb-2">10:08</h2>
                                <p className="text-primary/60 font-sans tracking-[0.5em] uppercase text-sm font-bold">Monday, Oct 23</p>
                            </div>
                        </div>
                        <div className="space-y-4">
                            <h2 className="text-2xl font-bold text-cream-light/90 uppercase tracking-[0.3em] mb-4">Notifications</h2>
                            <div className="glass-panel p-6 rounded-3xl flex gap-5 border-l-4 border-l-orange-500 hover:bg-white/5 transition-all cursor-pointer">
                                <div className="w-12 h-12 rounded-2xl bg-orange-500/10 flex items-center justify-center text-orange-500 shrink-0">
                                    <span className="material-symbols-outlined">priority_high</span>
                                </div>
                                <div className="flex-1">
                                    <h4 className="font-bold text-cream-light">Task Deadline Reached</h4>
                                    <p className="text-sm text-cream-light/60 font-sans mt-1">The project proposal deadline has passed.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </Layout>
        );

        const LoadingPage = ({ onComplete }) => {
            useEffect(() => {
                const timer = setTimeout(onComplete, 2500);
                return () => clearTimeout(timer);
            }, [onComplete]);

            return (
                <div className="fixed inset-0 z-50 blur-overlay flex flex-col items-center justify-center">
                    <div className="loading-arc-container relative flex items-center justify-center w-[252px] h-[252px]">
                        <div className="loading-arc"></div>
                        <div className="absolute flex flex-col items-center text-center z-10">
                            <div className="relative">
                                <div className="flame-container">
                                    {[...Array(5)].map((_, i) => (
                                        <div key={i} className="flame-tongue" style={{animationDelay: `${i * 0.15}s`}}></div>
                                    ))}
                                </div>
                                <h1 className="text-7xl font-bold tracking-tight text-cream-light italic leading-none drop-shadow-[0_0_30px_rgba(249,115,22,0.4)]">
                                    Faiora
                                </h1>
                            </div>
                            <div className="mt-8">
                                <p className="text-primary text-[10px] uppercase tracking-[0.8em] font-sans font-bold">Fallo ora</p>
                            </div>
                        </div>
                    </div>
                    <div className="absolute bottom-24 w-full px-12 max-w-md">
                        <div className="flex justify-between items-end mb-4 px-1">
                            <span className="text-[10px] font-sans font-medium uppercase tracking-[0.2em] text-white/40">Awakening Systems</span>
                            <span className="text-xs font-sans font-bold text-primary tracking-tighter">100%</span>
                        </div>
                        <div className="relative h-[4px] w-full bg-white/5 rounded-full overflow-hidden">
                            <div className="absolute top-0 left-0 h-full bg-primary w-full rounded-full transition-all duration-[2000ms] ease-out"></div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Root Component ---
        


        const TransitionManager = ({ children }) => {
            const location = useLocation();
            const [displayLocation, setDisplayLocation] = useState(location);
            const [isWiping, setIsWiping] = useState(false);
            const [isDissolving, setIsDissolving] = useState(false);
            const [transitionKey, setTransitionKey] = useState(0);

            const playFireSFX = () => {
                const audio = new Audio('fire_transition_sfx.mp3');
                audio.volume = 0.4; // 40% volume
                audio.play().catch(e => console.log("Audio play blocked", e));
                
                // Fade out after 1 second
                setTimeout(() => {
                    const fadeDuration = 500; // 0.5s fade
                    const step = 0.05;
                    const interval = fadeDuration / (0.4 / step);
                    
                    const fadeInterval = setInterval(() => {
                        if (audio.volume > step) {
                            audio.volume -= step;
                        } else {
                            audio.volume = 0;
                            clearInterval(fadeInterval);
                            audio.pause();
                        }
                    }, interval);
                }, 1000);
            };

            useEffect(() => {
                // Trigger wipe on initial mount (post-loader)
                setIsWiping(true);
                setIsDissolving(true);
                setTransitionKey(prev => prev + 1);
                
                playFireSFX();
                
                const swapTimer = setTimeout(() => {
                    setIsDissolving(false);
                }, 900);

                const doneTimer = setTimeout(() => {
                    setIsWiping(false);
                }, 2000);

                return () => {
                    clearTimeout(swapTimer);
                    clearTimeout(doneTimer);
                };
            }, []);

            useEffect(() => {
                if (location.pathname !== displayLocation.pathname) {
                    setIsWiping(true);
                    setIsDissolving(true);
                    setTransitionKey(prev => prev + 1);

                    playFireSFX();
                    
                    // MIDPOINT: Swap content when fire covers screen
                    const swapTimer = setTimeout(() => {
                        setDisplayLocation(location);
                        setIsDissolving(false);
                    }, 900);

                    // END: Cleanup wipe
                    const doneTimer = setTimeout(() => {
                        setIsWiping(false);
                    }, 2000);

                    return () => {
                        clearTimeout(swapTimer);
                        clearTimeout(doneTimer);
                    };
                }
            }, [location, displayLocation]);

            return (
                <div className="relative w-full h-full overflow-hidden">
                    {isWiping && (
                        <div key={transitionKey} className="fire-wipe-overlay fire-wipe-active">
                            <div className="fire-wipe-sprite"></div>
                        </div>
                    )}
                    <div key={displayLocation.pathname} className={`w-full h-full transition-all duration-300 ${isDissolving ? 'dissolve-out' : 'dissolve-in'}`}>
                        <Routes location={displayLocation}>
                            {children}
                        </Routes>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [isTimerDone, setIsTimerDone] = useState(false);
            const [isAuthChecked, setIsAuthChecked] = useState(false);
            const [isCreatorOpen, setIsCreatorOpen] = useState(false);
            const [user, setUser] = useState(null);
            const videoRef = useRef();

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((u) => {
                    setUser(u);
                    setIsAuthChecked(true);
                    
                    // If user is already found (logged in), we can skip some of the wait 
                    // to make the "redirect" feel faster.
                    if (u) {
                        localStorage.setItem('faiora_logged_in', 'true');
                    }
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                const timer = setTimeout(() => {
                    setIsTimerDone(true);
                }, 2500);
                return () => clearTimeout(timer);
            }, []);

            useEffect(() => {
                if (videoRef.current) {
                    videoRef.current.playbackRate = 1.5;
                }
            }, [user, isTimerDone, isAuthChecked]);

            // We show the loader until:
            // 1. The 2.5s aesthetic timer is done.
            // 2. AND we've actually checked with Firebase if someone is logged in.
            if (!isTimerDone || !isAuthChecked) {
                return <LoadingPage onComplete={() => setIsTimerDone(true)} />;
            }

            // If we are "Checking" but have no user, show the modal.
            // As soon as 'user' is set by the popup, this component re-renders and swaps to the main app.
            if (!user) {
                return <LoginModal />;
            }

            // REDIRECT TO INDEX: When user is authenticated, we render the main app.
            // Since it's a new mount of MemoryRouter, it defaults to path="/".
            return (
                <MemoryRouter>
                    <video 
                        ref={videoRef}
                        className="fire-bg-video"
                        autoPlay 
                        loop 
                        muted 
                        playsInline
                        src="fire_bg_video.mp4"
                    />
                    <TransitionManager>
                        <Route path="/" element={<DashboardPage user={user} onOpenCreator={() => setIsCreatorOpen(true)} />} />
                        <Route path="/notes" element={<NotesPage user={user} onOpenCreator={() => setIsCreatorOpen(true)} />} />
                        <Route path="/calendar" element={<CalendarPage user={user} onOpenCreator={() => setIsCreatorOpen(true)} />} />
                        <Route path="/stats" element={<StatsPage user={user} onOpenCreator={() => setIsCreatorOpen(true)} />} />
                        <Route path="/streak" element={<StreakPage user={user} onOpenCreator={() => setIsCreatorOpen(true)} />} />
                        <Route path="/clock" element={<ClockPage user={user} onOpenCreator={() => setIsCreatorOpen(true)} />} />
                    </TransitionManager>
                    {isCreatorOpen && <TaskCreator onClose={() => setIsCreatorOpen(false)} user={user} />}
                </MemoryRouter>
            );
        };

        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>